!function() {
    "use strict";
    function AddBillController($state, dataAccessService, SalesService, constants, alertMessage, messages) {
        function saveBill(form) {
            dataAccessService.feed("/api/post/add/bill", vm.billDetails).then(function(response) {
                vm.alertService.addAlert("success", messages.successMsgs.ITEM_ADDED), resetBill(form);
            }, function(error) {
                vm.alertService.addAlert("danger", messages.errorMsgs.ITEM_ADDED);
            });
        }
        function resetBill(form) {
            vm.calculate(vm.billDetails), form.$setValidity(), form.$setPristine(), form.$setUntouched();
        }
        function activate(params) {
            vm.calculate(vm.billDetails);
        }
        var vm = this;
        vm.billDetails = SalesService.billDetails, vm.getCustomers = SalesService.getCustomers, 
        vm.getProducts = SalesService.getProducts, vm.addNewWeightRow = SalesService.addNewWeightRow, 
        vm.removeWeightRow = SalesService.removeWeightRow, vm.calculate = SalesService.calculateBill, 
        vm.alertService = alertMessage, vm.addNewRow = SalesService.addNewRow, vm.removeRow = SalesService.removeRow, 
        vm.saveBill = saveBill, vm.resetBill = resetBill, activate();
    }
    angular.module("myShopApp").controller("AddBillController", AddBillController), 
    AddBillController.$inject = [ "$state", "dataAccessService", "SalesService", "constants", "alertMessage", "messages" ];
}(), function() {
    "use strict";
    function EditBillController($state, dataAccessService, SalesService, constants, alertMessage, messages, billItem) {
        function updateBill() {
            dataAccessService.update("/api/put/update/bill", vm.billDetails).then(function(response) {
                vm.alertService.addAlert("success", messages.successMsgs.ITEM_ADDED), $state.go("main.sales.listBill");
            }, function(error) {
                vm.alertService.addAlert("danger", messages.errorMsgs.ITEM_ADDED);
            });
        }
        function cancelUpdate() {
            $state.go("main.sales.listBill");
        }
        function activate(params) {
            vm.calculate(vm.billDetails), vm.billDetails.billDate = new Date(vm.billDetails.billDate);
        }
        var vm = this;
        vm.billDetails = billItem, vm.getCustomers = SalesService.getCustomers, vm.getProducts = SalesService.getProducts, 
        vm.addNewWeightRow = SalesService.addNewWeightRow, vm.removeWeightRow = SalesService.removeWeightRow, 
        vm.calculate = SalesService.calculateBill, vm.alertService = alertMessage, vm.addNewRow = SalesService.addNewRow, 
        vm.removeRow = SalesService.removeRow, vm.updateBill = updateBill, vm.cancelUpdate = cancelUpdate, 
        activate();
    }
    angular.module("myShopApp").controller("EditBillController", EditBillController), 
    EditBillController.$inject = [ "$state", "dataAccessService", "SalesService", "constants", "alertMessage", "messages", "billItem" ];
}(), function() {
    "use strict";
    function ListBillController(bills, $location) {
        function editBill(billId) {
            $location.path("/main/sales/editbill/" + billId);
        }
        function viewBill(billId) {
            $location.path("/main/sales/viewbill/" + billId);
        }
        function activate() {
            vm.bills = bills;
        }
        var vm = this;
        vm.editBill = editBill, vm.viewBill = viewBill, activate();
    }
    angular.module("myShopApp").controller("ListBillController", ListBillController), 
    ListBillController.$inject = [ "bills", "$location" ];
}(), function() {
    "use strict";
    function ViewBillController(billItem, $location, SalesService) {
        function printBill(billId) {}
        function cancelView() {
            $location.path("/main/sales/listBill");
        }
        function activate() {
            vm.billDetails = billItem, SalesService.calculateBill(vm.billDetails);
        }
        var vm = this;
        vm.printBill = printBill, vm.cancelView = cancelView, activate();
    }
    angular.module("myShopApp").controller("ViewBillController", ViewBillController), 
    ViewBillController.$inject = [ "billItem", "$location", "SalesService" ];
}(), function() {
    "use strict";
    function DashboardSalesController(dataAccessService) {
        function activate() {
            dataAccessService.fetch("/api/get/count/bill").then(function(count) {
                vm.billCount = count;
            });
        }
        var vm = this;
        activate();
    }
    angular.module("myShopApp").controller("DashboardSalesController", DashboardSalesController), 
    DashboardSalesController.inject = [ "dataAccessService" ];
}(), function() {
    "use strict";
    function SalesService(dataAccessService, constants) {
        function BillItem() {
            this.product = "", this.units = 1, this.weights = [ 0 ], this.rate = 0, this.brand = "";
        }
        function addNewRow(billDetails) {
            billDetails.billItems.push(new BillItem());
        }
        function removeRow(index, billDetails) {
            billDetails.billItems.splice(index, 1);
        }
        function calculateLavy(billDetails) {
            for (var totalWeight = 0, index = 0; index < billDetails.weights.length; index++) totalWeight += billDetails.weights[index];
            totalWeight < 25 ? billDetails.lavy = "" : condition || condition || condition;
        }
        function addNewWeightRow(currentItem) {
            currentItem.weights.push(0);
        }
        function removeWeightRow(currentItem, index) {
            currentItem.weights.splice(index, 1);
        }
        function calculateBill(billDetails) {
            billDetails.grandTotal = 0, billDetails.subTotal = 0;
            for (var index = 0; index < billDetails.billItems.length; index++) {
                var item = billDetails.billItems[index];
                if (item.total = 0, !isNaN(item.rate) && !isNaN(item.units)) {
                    for (var weightIndex = 0; weightIndex < item.weights.length; weightIndex++) item.weights[weightIndex] && (item.total += Math.round(item.rate * item.weights[weightIndex] * 100) / 100);
                    billDetails.subTotal += item.total;
                }
            }
            billDetails.subTotal && (billDetails.lavy = constants.LAVY, billDetails.labourCharge = Math.round(constants.LABOUR_CHARGE_PERCENTAGE / 100 * billDetails.subTotal * 100) / 100, 
            billDetails.grandTotal += Math.round(100 * (billDetails.lavy + billDetails.labourCharge + billDetails.subTotal)) / 100);
        }
        function getCustomers(val) {
            return dataAccessService.fetch("/api/get/find/customer/" + val).then(function(customers) {
                return customers;
            });
        }
        function getProducts(val) {
            return dataAccessService.fetch("/api/get/find/product/" + val).then(function(products) {
                return products;
            });
        }
        this.billDetails = {
            billDate: new Date(),
            labourCharge: 0,
            transportCharge: 0,
            tax: 0,
            lavy: 0,
            subTotal: 0,
            billItems: [ new BillItem() ]
        }, this.calculateBill = calculateBill, this.getCustomers = getCustomers, this.getProducts = getProducts, 
        this.calculateLavy = calculateLavy, this.removeWeightRow = removeWeightRow, this.addNewWeightRow = addNewWeightRow, 
        this.addNewRow = addNewRow, this.removeRow = removeRow;
    }
    angular.module("myShopApp").service("SalesService", SalesService), SalesService.inject = [ "dataAccessService", "constants" ];
}();